{"version":3,"sources":["../../../src/plugins/DragDrop/index.js"],"names":["Plugin","require","Translator","toArray","dragDrop","module","exports","core","opts","type","id","title","icon","defaultLocale","strings","dropHereOr","browse","defaultOpts","target","getMetaFromForm","width","height","note","locale","isDragDropSupported","checkDragDropSupport","translator","i18n","translate","bind","handleDrop","handleInputChange","render","div","document","createElement","window","files","log","forEach","file","addFile","source","name","data","ev","state","onSelect","input","querySelector","click","preventDefault","install","plugin","mount","uninstall","unmount","args","dndContainer","removeDragDropListener"],"mappings":"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","file":"index.js","sourcesContent":["const Plugin = require('./../Plugin')\nconst Translator = require('../../core/Translator')\nconst { toArray } = require('../../core/Utils')\nconst dragDrop = require('drag-drop')\nconst html = require('yo-yo')\n\n/**\n * Drag & Drop plugin\n *\n */\nmodule.exports = class DragDrop extends Plugin {\n  constructor (core, opts) {\n    super(core, opts)\n    this.type = 'acquirer'\n    this.id = 'DragDrop'\n    this.title = 'Drag & Drop'\n    this.icon = html`\n      <svg aria-hidden=\"true\" class=\"UppyIcon\" width=\"28\" height=\"28\" viewBox=\"0 0 16 16\">\n        <path d=\"M15.982 2.97c0-.02 0-.02-.018-.037 0-.017-.017-.035-.035-.053 0 0 0-.018-.02-.018-.017-.018-.034-.053-.052-.07L13.19.123c-.017-.017-.034-.035-.07-.053h-.018c-.018-.017-.035-.017-.053-.034h-.02c-.017 0-.034-.018-.052-.018h-6.31a.415.415 0 0 0-.446.426V11.11c0 .25.196.446.445.446h8.89A.44.44 0 0 0 16 11.11V3.023c-.018-.018-.018-.035-.018-.053zm-2.65-1.46l1.157 1.157h-1.157V1.51zm1.78 9.157h-8V.89h5.332v2.22c0 .25.196.446.445.446h2.22v7.11z\"/>\n        <path d=\"M9.778 12.89H4V2.666a.44.44 0 0 0-.444-.445.44.44 0 0 0-.445.445v10.666c0 .25.197.445.446.445h6.222a.44.44 0 0 0 .444-.445.44.44 0 0 0-.444-.444z\"/>\n        <path d=\"M.444 16h6.223a.44.44 0 0 0 .444-.444.44.44 0 0 0-.443-.445H.89V4.89a.44.44 0 0 0-.446-.446A.44.44 0 0 0 0 4.89v10.666c0 .248.196.444.444.444z\"/>\n      </svg>\n    `\n\n    const defaultLocale = {\n      strings: {\n        dropHereOr: 'Drop files here or',\n        browse: 'browse'\n        // selectedFiles: {\n        //   0: '%{smart_count} file selected',\n        //   1: '%{smart_count} files selected'\n        // }\n      }\n    }\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n      getMetaFromForm: true,\n      width: '100%',\n      height: '100%',\n      note: '',\n      locale: defaultLocale\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOpts, opts)\n\n        // Check for browser dragDrop support\n    this.isDragDropSupported = this.checkDragDropSupport()\n\n    this.locale = Object.assign({}, defaultLocale, this.opts.locale)\n    this.locale.strings = Object.assign({}, defaultLocale.strings, this.opts.locale.strings)\n\n    // i18n\n    this.translator = new Translator({locale: this.locale})\n    this.i18n = this.translator.translate.bind(this.translator)\n\n    // Bind `this` to class methods\n    this.handleDrop = this.handleDrop.bind(this)\n    this.checkDragDropSupport = this.checkDragDropSupport.bind(this)\n    this.handleInputChange = this.handleInputChange.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n/**\n * Checks if the browser supports Drag & Drop (not supported on mobile devices, for example).\n * @return {Boolean} true if supported, false otherwise\n */\n  checkDragDropSupport () {\n    const div = document.createElement('div')\n\n    if (!('draggable' in div) || !('ondragstart' in div && 'ondrop' in div)) {\n      return false\n    }\n\n    if (!('FormData' in window)) {\n      return false\n    }\n\n    if (!('FileReader' in window)) {\n      return false\n    }\n\n    return true\n  }\n\n  handleDrop (files) {\n    this.core.log('[DragDrop] Files dropped')\n\n    files.forEach((file) => {\n      this.core.addFile({\n        source: this.id,\n        name: file.name,\n        type: file.type,\n        data: file\n      })\n    })\n  }\n\n  handleInputChange (ev) {\n    this.core.log('[DragDrop] Files selected through input')\n\n    const files = toArray(ev.target.files)\n\n    files.forEach((file) => {\n      this.core.addFile({\n        source: this.id,\n        name: file.name,\n        type: file.type,\n        data: file\n      })\n    })\n  }\n\n  render (state) {\n    const onSelect = (ev) => {\n      const input = this.target.querySelector('.uppy-DragDrop-input')\n      input.click()\n    }\n\n    // const selectedFilesCount = Object.keys(state.files).length\n\n    return html`\n      <div class=\"Uppy UppyTheme--default uppy-DragDrop-container ${this.isDragDropSupported ? 'is-dragdrop-supported' : ''}\"\n           style=\"width: ${this.opts.width}; height: ${this.opts.height};\">\n        <form class=\"uppy-DragDrop-inner\" onsubmit=${(ev) => ev.preventDefault()}>\n          <svg class=\"UppyIcon uppy-DragDrop-arrow\" aria-hidden=\"true\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fill-rule=\"evenodd\"/>\n          </svg>\n          <input class=\"uppy-DragDrop-input uppy-DragDrop-focus\"\n                 type=\"file\"\n                 name=\"files[]\"\n                 multiple=\"true\"\n                 value=\"\"\n                 onchange=${this.handleInputChange.bind(this)} />\n          <label class=\"uppy-DragDrop-label\" onclick=${onSelect}>\n            ${this.i18n('dropHereOr')}\n            <span class=\"uppy-DragDrop-dragText\">${this.i18n('browse')}</span>\n          </label>\n          <span class=\"uppy-DragDrop-note\">${this.opts.note}</span>\n        </form>\n      </div>\n    `\n  }\n\n  // ${selectedFilesCount > 0\n  // ? html`<div class=\"uppy-DragDrop-selectedCount\">\n  //     ${this.i18n('selectedFiles', {'smart_count': selectedFilesCount})}\n  //   </div>`\n  // : ''}\n\n  install () {\n    const target = this.opts.target\n    const plugin = this\n    if (target) {\n      this.mount(target, plugin)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n\n  mount (...args) {\n    super.mount(...args)\n\n    const dndContainer = this.target.querySelector('.uppy-DragDrop-container')\n    this.removeDragDropListener = dragDrop(dndContainer, (files) => {\n      this.handleDrop(files)\n      this.core.log(files)\n    })\n  }\n\n  unmount (...args) {\n    this.removeDragDropListener()\n\n    super.unmount(...args)\n  }\n}\n"]}